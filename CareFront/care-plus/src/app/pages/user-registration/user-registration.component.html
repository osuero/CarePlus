<section class="card registration-card">
  <div class="card-header">
    <div>
      <h1 class="title">{{ 'userRegistration.title' | translate }}</h1>
      <p class="subtitle">{{ 'userRegistration.description' | translate }}</p>
    </div>
  </div>

  <form class="form-grid" [formGroup]="form" (ngSubmit)="submit()" novalidate>
    <div class="form-field">
      <label for="firstName">{{ 'userRegistration.firstName' | translate }}</label>
      <input id="firstName" type="text" formControlName="firstName" />
      <p class="error" *ngIf="isInvalid('firstName')">{{ 'validation.required' | translate }}</p>
    </div>

    <div class="form-field">
      <label for="lastName">{{ 'userRegistration.lastName' | translate }}</label>
      <input id="lastName" type="text" formControlName="lastName" />
      <p class="error" *ngIf="isInvalid('lastName')">{{ 'validation.required' | translate }}</p>
    </div>

    <div class="form-field">
      <label for="email">{{ 'userRegistration.email' | translate }}</label>
      <input id="email" type="email" formControlName="email" />
      <p class="error" *ngIf="isInvalid('email')">
        {{ form.controls.email.errors?.['email'] ? ('validation.email' | translate) : ('validation.required' | translate) }}
      </p>
    </div>

    <div class="form-field">
      <label for="phoneNumber">{{ 'userRegistration.phone' | translate }}</label>
      <input id="phoneNumber" type="tel" formControlName="phoneNumber" placeholder="+1 555 123 4567" />
      <p class="error" *ngIf="form.controls.phoneNumber.invalid && form.controls.phoneNumber.touched">
        {{ 'validation.phone' | translate }}
      </p>
    </div>

    <div class="form-field">
      <label for="identification">{{ 'userRegistration.identification' | translate }}</label>
      <input id="identification" type="text" formControlName="identification" />
    </div>

    <div class="form-field">
      <label for="country">{{ 'userRegistration.country' | translate }}</label>
      <div class="country-autocomplete">
        <input
          id="country"
          type="text"
          formControlName="country"
          autocomplete="off"
          (focus)="onCountryFocus()"
          (blur)="onCountryBlur()"
        />
        <div class="dropdown" *ngIf="showCountryDropdown()">
          <div class="dropdown-item loading" *ngIf="isLoadingCountries()">
            <span class="spinner"></span>
            <span>{{ 'userRegistration.countryLoading' | translate }}</span>
          </div>
          <button
            type="button"
            class="dropdown-item"
            *ngFor="let option of countryResults(); trackBy: trackByCountry"
            (mousedown)="selectCountry(option)"
          >
            <span>{{ option.name }}</span>
            <small>{{ option.code }}</small>
          </button>
          <div class="dropdown-item empty" *ngIf="!isLoadingCountries() && countryResults().length === 0">
            {{ 'userRegistration.countryNoResults' | translate }}
          </div>
        </div>
      </div>
    </div>

    <div class="form-field">
      <label for="gender">{{ 'userRegistration.gender' | translate }}</label>
      <select id="gender" formControlName="gender">
        <option *ngFor="let option of genderOptions" [value]="option">
          {{ ('userRegistration.genderOptions.' + option) | translate }}
        </option>
      </select>
      <p class="error" *ngIf="isInvalid('gender')">{{ 'validation.required' | translate }}</p>
    </div>

    <div class="form-field">
      <label for="dateOfBirth">{{ 'userRegistration.birthDate' | translate }}</label>
      <input id="dateOfBirth" type="date" formControlName="dateOfBirth" />
      <ng-container *ngIf="isInvalid('dateOfBirth')">
        <p class="error" *ngIf="form.controls.dateOfBirth.errors?.['required']">
          {{ 'validation.required' | translate }}
        </p>
        <p class="error" *ngIf="form.controls.dateOfBirth.errors?.['futureDate']">
          {{ 'validation.futureDate' | translate }}
        </p>
        <p class="error" *ngIf="form.controls.dateOfBirth.errors?.['minDate']">
          {{ 'validation.minDate' | translate }}
        </p>
        <p class="error" *ngIf="form.controls.dateOfBirth.errors?.['invalidDate']">
          {{ 'validation.invalidDate' | translate }}
        </p>
      </ng-container>
    </div>
    <div class="meta" *ngIf="calculatedAge() !== null">
      <span class="badge info">{{ 'userRegistration.calculatedAge' | translate:{ age: calculatedAge() } }}</span>
    </div>

    <div class="actions">
      <button class="btn primary" type="submit" [disabled]="isSubmitting()">
        <span class="spinner" *ngIf="isSubmitting()"></span>
        <span>{{ 'userRegistration.submit' | translate }}</span>
      </button>
      <button class="btn ghost" type="button" (click)="reset()" [disabled]="isSubmitting()">
        {{ 'userRegistration.reset' | translate }}
      </button>
    </div>

    <div class="alert success" *ngIf="submitSuccess()">{{ 'userRegistration.success' | translate }}</div>
    <div class="alert error" *ngIf="submitError() as errorMessage">{{ errorMessage }}</div>
  </form>
</section>
