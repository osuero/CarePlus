<section class="card user-list-card">
  <div class="card-header">
    <div>
      <h1 class="title">{{ 'users.title' | translate }}</h1>
      <p class="subtitle">{{ 'users.description' | translate }}</p>
    </div>
    <a class="btn primary" routerLink="/users/register">
      <app-icon name="person_add"></app-icon>
      <span>{{ 'users.registerButton' | translate }}</span>
    </a>
  </div>

  <div class="filters">
    <label class="filter-label" for="search">{{ 'users.searchLabel' | translate }}</label>
    <div class="search-field">
      <app-icon name="search"></app-icon>
      <input
        id="search"
        type="search"
        [formControl]="searchControl"
        [placeholder]="'users.searchPlaceholder' | translate"
      />
    </div>
    <span class="total-chip">{{ 'users.totalLabel' | translate:{ total: totalCount() } }}</span>
  </div>

  <div class="table-wrapper">
    <table class="table">
      <thead>
        <tr>
          <th scope="col">
            <button class="sort-btn" type="button" (click)="changeSort('firstName')">
              {{ 'users.columns.firstName' | translate }}
              <app-icon [name]="getSortIcon('firstName')"></app-icon>
            </button>
          </th>
          <th scope="col">
            <button class="sort-btn" type="button" (click)="changeSort('lastName')">
              {{ 'users.columns.lastName' | translate }}
              <app-icon [name]="getSortIcon('lastName')"></app-icon>
            </button>
          </th>
          <th scope="col">{{ 'users.columns.email' | translate }}</th>
          <th scope="col">{{ 'users.columns.identification' | translate }}</th>
          <th scope="col">{{ 'users.columns.country' | translate }}</th>
          <th scope="col">
            <button class="sort-btn" type="button" (click)="changeSort('createdAtUtc')">
              {{ 'users.columns.createdAt' | translate }}
              <app-icon [name]="getSortIcon('createdAtUtc')"></app-icon>
            </button>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngIf="isLoading()">
          <td colspan="6">
            <div class="loading">
              <span class="spinner"></span>
              <span>{{ 'users.loading' | translate }}</span>
            </div>
          </td>
        </tr>
        <tr *ngIf="!isLoading() && !hasResults()">
          <td colspan="6" class="empty">{{ loadError() || ('users.noResults' | translate) }}</td>
        </tr>
        <tr *ngFor="let user of sortedUsers(); trackBy: trackByUserId">
          <td>{{ user.firstName }}</td>
          <td>{{ user.lastName }}</td>
          <td>{{ user.email }}</td>
          <td>{{ user.identification || ('users.notProvided' | translate) }}</td>
          <td>{{ user.country || ('users.notProvided' | translate) }}</td>
          <td>{{ user.createdAtUtc | date: 'medium' }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="pagination">
    <div class="pagination-info">
      {{ 'users.paginationLabel' | translate:{
        page: page(),
        totalPages: totalPages(),
        pageSize: pageSize(),
        total: totalCount()
      } }}
    </div>
    <div class="pagination-controls">
      <button type="button" class="icon-btn" [disabled]="page() === 1" (click)="changePage(-1)">
        <app-icon name="chevron_left"></app-icon>
      </button>
      <button
        type="button"
        class="page-btn"
        *ngFor="let pageNumber of pageNumbers(); trackBy: trackByPageNumber"
        [class.active]="page() === pageNumber"
        (click)="goToPage(pageNumber)"
      >
        {{ pageNumber }}
      </button>
      <button
        type="button"
        class="icon-btn"
        [disabled]="page() === totalPages()"
        (click)="changePage(1)"
      >
        <app-icon name="chevron_right"></app-icon>
      </button>
    </div>
  </div>
</section>
