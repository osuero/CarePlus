<form [formGroup]="form" (ngSubmit)="submit()">
  <h2 mat-dialog-title class="d-flex align-items-center gap-2">
    <mat-icon>person_add</mat-icon>
    {{ 'PATIENTS.FORM.TITLE' | translate }}
  </h2>

  <div mat-dialog-content>
    <div class="row g-3">
      <div class="col-md-6">
        <label class="form-label" for="firstName">
          {{ 'PATIENTS.FORM.FIELDS.FIRST_NAME.LABEL' | translate }} *
        </label>
        <input
          id="firstName"
          type="text"
          class="form-control"
          formControlName="firstName"
          [placeholder]="
            'PATIENTS.FORM.FIELDS.FIRST_NAME.PLACEHOLDER' | translate
          "
          [class.is-invalid]="
            form.get('firstName')?.invalid &&
            (form.get('firstName')?.dirty || form.get('firstName')?.touched)
          "
          autocomplete="given-name"
        />
        <div
          class="invalid-feedback d-block"
          *ngIf="
            form.get('firstName')?.invalid &&
            (form.get('firstName')?.dirty || form.get('firstName')?.touched)
          "
        >
          {{ 'PATIENTS.FORM.FIELDS.FIRST_NAME.ERROR' | translate }}
        </div>
      </div>
      <div class="col-md-6">
        <label class="form-label" for="lastName">
          {{ 'PATIENTS.FORM.FIELDS.LAST_NAME.LABEL' | translate }} *
        </label>
        <input
          id="lastName"
          type="text"
          class="form-control"
          formControlName="lastName"
          [placeholder]="
            'PATIENTS.FORM.FIELDS.LAST_NAME.PLACEHOLDER' | translate
          "
          [class.is-invalid]="
            form.get('lastName')?.invalid &&
            (form.get('lastName')?.dirty || form.get('lastName')?.touched)
          "
          autocomplete="family-name"
        />
        <div
          class="invalid-feedback d-block"
          *ngIf="
            form.get('lastName')?.invalid &&
            (form.get('lastName')?.dirty || form.get('lastName')?.touched)
          "
        >
          {{ 'PATIENTS.FORM.FIELDS.LAST_NAME.ERROR' | translate }}
        </div>
      </div>
      <div class="col-12">
        <label class="form-label" for="email">
          {{ 'PATIENTS.FORM.FIELDS.EMAIL.LABEL' | translate }} *
        </label>
        <input
          id="email"
          type="email"
          class="form-control"
          formControlName="email"
          [placeholder]="
            'PATIENTS.FORM.FIELDS.EMAIL.PLACEHOLDER' | translate
          "
          [class.is-invalid]="
            form.get('email')?.invalid &&
            (form.get('email')?.dirty || form.get('email')?.touched)
          "
          autocomplete="email"
        />
        <div
          class="invalid-feedback d-block"
          *ngIf="
            form.get('email')?.invalid &&
            (form.get('email')?.dirty || form.get('email')?.touched)
          "
        >
          <ng-container
            *ngIf="form.get('email')?.hasError('required'); else emailFormat"
          >
            {{ 'PATIENTS.FORM.FIELDS.EMAIL.REQUIRED_ERROR' | translate }}
          </ng-container>
          <ng-template #emailFormat>
            {{ 'PATIENTS.FORM.FIELDS.EMAIL.FORMAT_ERROR' | translate }}
          </ng-template>
        </div>
      </div>
      <div class="col-md-6">
        <label class="form-label" for="phoneNumber">
          {{ 'PATIENTS.FORM.FIELDS.PHONE.LABEL' | translate }} *
        </label>
        <input
          id="phoneNumber"
          type="tel"
          class="form-control"
          formControlName="phoneNumber"
          [placeholder]="
            'PATIENTS.FORM.FIELDS.PHONE.PLACEHOLDER' | translate
          "
          autocomplete="tel"
          [class.is-invalid]="
            form.get('phoneNumber')?.invalid &&
            (form.get('phoneNumber')?.dirty || form.get('phoneNumber')?.touched)
          "
        />
        <div
          class="invalid-feedback d-block"
          *ngIf="
            form.get('phoneNumber')?.invalid &&
            (form.get('phoneNumber')?.dirty || form.get('phoneNumber')?.touched)
          "
        >
          <ng-container
            *ngIf="form.get('phoneNumber')?.hasError('required'); else phoneMaxLength"
          >
            {{ 'PATIENTS.FORM.FIELDS.PHONE.ERROR' | translate }}
          </ng-container>
          <ng-template #phoneMaxLength>
            {{ 'PATIENTS.FORM.FIELDS.PHONE.MAX_LENGTH_ERROR' | translate }}
          </ng-template>
        </div>
      </div>
      <div class="col-md-6">
        <label class="form-label" for="identification">
          {{ 'PATIENTS.FORM.FIELDS.IDENTIFICATION.LABEL' | translate }} *
        </label>
        <input
          id="identification"
          type="text"
          class="form-control"
          formControlName="identification"
          [placeholder]="
            'PATIENTS.FORM.FIELDS.IDENTIFICATION.PLACEHOLDER' | translate
          "
          autocomplete="off"
          [class.is-invalid]="
            form.get('identification')?.invalid &&
            (form.get('identification')?.dirty ||
              form.get('identification')?.touched)
          "
        />
        <div
          class="invalid-feedback d-block"
          *ngIf="
            form.get('identification')?.invalid &&
            (form.get('identification')?.dirty ||
              form.get('identification')?.touched)
          "
        >
          <ng-container
            *ngIf="form.get('identification')?.hasError('required'); else identificationMaxLength"
          >
            {{ 'PATIENTS.FORM.FIELDS.IDENTIFICATION.ERROR' | translate }}
          </ng-container>
          <ng-template #identificationMaxLength>
            {{
              'PATIENTS.FORM.FIELDS.IDENTIFICATION.MAX_LENGTH_ERROR' | translate
            }}
          </ng-template>
        </div>
      </div>
      <div class="col-md-6">
        <label class="form-label" for="gender">
          {{ 'PATIENTS.FORM.FIELDS.GENDER.LABEL' | translate }} *
        </label>
        <select
          id="gender"
          class="form-select"
          formControlName="gender"
          [class.is-invalid]="
            form.get('gender')?.invalid &&
            (form.get('gender')?.dirty || form.get('gender')?.touched)
          "
        >
          <option value="" disabled>
            {{ 'PATIENTS.FORM.FIELDS.GENDER.LABEL' | translate }}
          </option>
          <option value="Male">
            {{ getGenderLabel('MALE') }}
          </option>
          <option value="Female">
            {{ getGenderLabel('FEMALE') }}
          </option>
          <option value="Other">
            {{ getGenderLabel('OTHER') }}
          </option>
        </select>
        <div
          class="invalid-feedback d-block"
          *ngIf="
            form.get('gender')?.invalid &&
            (form.get('gender')?.dirty || form.get('gender')?.touched)
          "
        >
          {{ 'PATIENTS.FORM.FIELDS.GENDER.ERROR' | translate }}
        </div>
      </div>
      <div class="col-md-6">
        <label class="form-label" for="tenantId">
          {{ 'PATIENTS.FORM.FIELDS.TENANT.LABEL' | translate }} *
        </label>
        <select
          id="tenantId"
          class="form-select"
          formControlName="tenantId"
          [class.is-invalid]="
            form.get('tenantId')?.invalid &&
            (form.get('tenantId')?.dirty || form.get('tenantId')?.touched)
          "
        >
          <option value="" disabled>
            {{ 'PATIENTS.FORM.FIELDS.TENANT.PLACEHOLDER' | translate }}
          </option>
          <option *ngFor="let tenant of tenants" [value]="tenant">
            {{ tenant }}
          </option>
        </select>
        <div
          class="invalid-feedback d-block"
          *ngIf="
            form.get('tenantId')?.invalid &&
            (form.get('tenantId')?.dirty || form.get('tenantId')?.touched)
          "
        >
          {{ 'PATIENTS.FORM.FIELDS.TENANT.ERROR' | translate }}
        </div>
      </div>
      <div class="col-md-6">
        <label class="form-label" for="assignedDoctorId">
          {{ 'PATIENTS.FORM.FIELDS.DOCTOR.LABEL' | translate }}
        </label>
        <select
          id="assignedDoctorId"
          class="form-select"
          formControlName="assignedDoctorId"
          [disabled]="loadingDoctors || doctors.length === 0"
          [class.is-invalid]="
            form.get('assignedDoctorId')?.invalid &&
            (form.get('assignedDoctorId')?.dirty ||
              form.get('assignedDoctorId')?.touched)
          "
        >
          <option value="">
            {{ 'PATIENTS.FORM.FIELDS.DOCTOR.PLACEHOLDER' | translate }}
          </option>
          <option
            *ngFor="let doctor of doctors; trackBy: trackByDoctorId"
            [value]="doctor.id"
          >
            {{ doctor.fullName }} â€” {{ doctor.email }}
          </option>
        </select>
        <div class="form-text" *ngIf="loadingDoctors">
          {{ 'PATIENTS.FORM.FIELDS.DOCTOR.LOADING' | translate }}
        </div>
        <div
          class="form-text text-muted"
          *ngIf="!loadingDoctors && doctors.length === 0"
        >
          {{ 'PATIENTS.FORM.FIELDS.DOCTOR.EMPTY' | translate }}
        </div>
      </div>
      <div class="col-md-6">
        <label class="form-label" for="country">
          {{ 'PATIENTS.FORM.FIELDS.COUNTRY.LABEL' | translate }} *
        </label>
        <select
          id="country"
          class="form-select"
          formControlName="country"
          [class.is-invalid]="
            form.get('country')?.invalid &&
            (form.get('country')?.dirty || form.get('country')?.touched)
          "
        >
          <option value="" disabled>
            {{ 'PATIENTS.FORM.FIELDS.COUNTRY.PLACEHOLDER' | translate }}
          </option>
          <option
            *ngFor="let country of countries; trackBy: trackByCountryCode"
            [value]="country.name"
          >
            {{ country.name }}
          </option>
        </select>
        <div
          class="invalid-feedback d-block"
          *ngIf="
            form.get('country')?.invalid &&
            (form.get('country')?.dirty || form.get('country')?.touched)
          "
        >
          {{ 'PATIENTS.FORM.FIELDS.COUNTRY.ERROR' | translate }}
        </div>
      </div>
      <div class="col-md-6">
        <label class="form-label" for="dateOfBirth">
          {{ 'PATIENTS.FORM.FIELDS.DATE_OF_BIRTH.LABEL' | translate }} *
        </label>
        <input
          id="dateOfBirth"
          type="date"
          class="form-control"
          formControlName="dateOfBirth"
          [class.is-invalid]="
            form.get('dateOfBirth')?.invalid &&
            (form.get('dateOfBirth')?.dirty || form.get('dateOfBirth')?.touched)
          "
        />
        <div
          class="invalid-feedback d-block"
          *ngIf="
            form.get('dateOfBirth')?.invalid &&
            (form.get('dateOfBirth')?.dirty ||
              form.get('dateOfBirth')?.touched)
          "
        >
          {{ 'PATIENTS.FORM.FIELDS.DATE_OF_BIRTH.ERROR' | translate }}
        </div>
      </div>
    </div>
  </div>

  <div mat-dialog-actions class="d-flex justify-content-end gap-2">
    <button
      mat-button
      type="button"
      (click)="close()"
      [disabled]="submitting"
    >
      {{ 'PATIENTS.DIALOG.CANCEL' | translate }}
    </button>
    <button
      mat-flat-button
      color="primary"
      type="submit"
      [disabled]="submitting"
    >
      <span
        class="spinner-border spinner-border-sm me-2"
        role="status"
        *ngIf="submitting"
      ></span>
      {{ 'PATIENTS.FORM.BUTTONS.SUBMIT' | translate }}
    </button>
  </div>
</form>
