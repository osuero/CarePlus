<div class="auth-container">
  <mat-card class="auth-card">
    <div class="card-content">
      <div class="form-section">
        <div class="form-content">
          <h2 class="title">Configurar contraseña</h2>
          <p class="subtitle">Estás a punto de activar tu cuenta.</p>

          <ng-container *ngIf="loading; else loadedContent">
            <div class="loading-container">
              <mat-spinner diameter="40"></mat-spinner>
            </div>
          </ng-container>

          <ng-template #loadedContent>
            <ng-container *ngIf="info; else errorBlock">
              <p class="welcome-message">
                Hola {{ info.firstName }} {{ info.lastName }}, configura tu nueva contraseña para continuar.
              </p>

              <form [formGroup]="form" (ngSubmit)="submit()" class="auth-form">
                <mat-form-field appearance="outline" class="form-field">
                  <mat-label>Nueva contraseña</mat-label>
                  <input
                    matInput
                    type="password"
                    formControlName="password"
                    placeholder="Ingresa tu contraseña"
                  />
                  <mat-error *ngIf="form.get('password')?.hasError('required')">
                    La contraseña es obligatoria
                  </mat-error>
                  <mat-error *ngIf="form.get('password')?.hasError('minlength')">
                    Debe tener al menos 8 caracteres
                  </mat-error>
                </mat-form-field>

                <mat-form-field appearance="outline" class="form-field">
                  <mat-label>Confirmar contraseña</mat-label>
                  <input
                    matInput
                    type="password"
                    formControlName="confirmPassword"
                    placeholder="Repite tu contraseña"
                  />
                  <mat-error *ngIf="form.get('confirmPassword')?.hasError('required')">
                    La confirmación es obligatoria
                  </mat-error>
                  <mat-error *ngIf="form.get('confirmPassword')?.hasError('minlength')">
                    Debe tener al menos 8 caracteres
                  </mat-error>
                </mat-form-field>

                <div class="error-message" *ngIf="error">{{ error }}</div>

                <button
                  mat-raised-button
                  type="submit"
                  class="create-btn"
                  [disabled]="submitting"
                >
                  <mat-spinner *ngIf="submitting" diameter="20" class="btn-spinner"></mat-spinner>
                  <span *ngIf="!submitting">Guardar contraseña</span>
                </button>
              </form>

              <div class="login-link">
                <span>¿Necesitas volver?</span>
                <a routerLink="/authentication/signin" class="login-text">Volver al inicio de sesión</a>
              </div>
            </ng-container>

            <ng-template #errorBlock>
              <div class="error-message">
                {{ error ?? 'El enlace no es válido o ha expirado. Solicita uno nuevo.' }}
              </div>
              <div class="login-link">
                <span>¿Deseas intentarlo de nuevo?</span>
                <a routerLink="/authentication/signin" class="login-text">Volver al inicio de sesión</a>
              </div>
            </ng-template>
          </ng-template>
        </div>
      </div>

      <div class="right-side-section">
        <img src="assets/images/pages/bg-04.png" alt="Configurar contraseña" class="right-side-image" />
      </div>
    </div>
  </mat-card>
</div>
