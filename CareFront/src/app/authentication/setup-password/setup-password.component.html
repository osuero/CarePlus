<div class="setup-container">
  <mat-card class="setup-card">
    <div class="card-content">
      <h2 class="title">Configurar contraseña</h2>
      <p class="subtitle">
        Estás a punto de activar tu cuenta.
      </p>

      <ng-container *ngIf="loading; else content">
        <div class="loading">
          <mat-spinner diameter="40"></mat-spinner>
        </div>
      </ng-container>

      <ng-template #content>
        <ng-container *ngIf="info; else errorBlock">
          <p class="welcome">
            Hola {{ info.firstName }} {{ info.lastName }},
            configura tu nueva contraseña para continuar.
          </p>

          <form [formGroup]="form" (ngSubmit)="submit()" class="setup-form">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Nueva contraseña</mat-label>
              <input
                matInput
                type="password"
                formControlName="password"
                placeholder="Ingresa tu contraseña"
              />
              <mat-error *ngIf="form.get('password')?.hasError('required')">
                La contraseña es obligatoria
              </mat-error>
              <mat-error *ngIf="form.get('password')?.hasError('minlength')">
                Debe tener al menos 8 caracteres
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Confirmar contraseña</mat-label>
              <input
                matInput
                type="password"
                formControlName="confirmPassword"
                placeholder="Repite tu contraseña"
              />
              <mat-error
                *ngIf="form.get('confirmPassword')?.hasError('required')"
              >
                La confirmación es obligatoria
              </mat-error>
              <mat-error
                *ngIf="form.get('confirmPassword')?.hasError('minlength')"
              >
                Debe tener al menos 8 caracteres
              </mat-error>
            </mat-form-field>

            <div class="error" *ngIf="error">{{ error }}</div>

            <button
              mat-raised-button
              color="primary"
              type="submit"
              [disabled]="submitting"
            >
              <mat-spinner
                *ngIf="submitting"
                diameter="20"
                class="btn-spinner"
              ></mat-spinner>
              <span *ngIf="!submitting">Guardar contraseña</span>
            </button>

            <div class="back-link">
              <a routerLink="/authentication/signin">Volver al inicio de sesión</a>
            </div>
          </form>
        </ng-container>

        <ng-template #errorBlock>
          <div class="error">
            {{ error ?? 'El enlace no es válido o ha expirado. Solicita uno nuevo.' }}
          </div>
          <div class="back-link">
            <a routerLink="/authentication/signin">Volver al inicio de sesión</a>
          </div>
        </ng-template>
      </ng-template>
    </div>
  </mat-card>
</div>
